# Пример биллинг сервиса

Заготовка для сервиса по работе с пользователями, кошельками и осуществлением транзакций.

Реализован на DRF.


## Особенности

Я понимаю, что для получении вебхука от платёжных систем (для пополнения кошелька)
должны быть сделаны отдельные эндпоинты,
но для примера и удобства проверки это обычный эндпоинт с авторизацией пользователя.
Давайте представим, что между платёжной системой и нашим сервисом стоит агрегирующий
сервис, который обрабатывает вебхуки и шлёт нам запрос непосредственно на создание транзакции=)

На самом же деле в кабинете каждой платёжной системы настраивается адрес вебхука 
и отдельно обрабатывается каждый формат.
Там идёт проверка каждой платёжной системы по-разному 
(а не авторизация внутреннего пользователя как в примере).


## Запуск тестов

```shell
docker-compose -f docker-compose.yml -f docker-compose.manage.yml up --build test
```

## Запуск сервиса

Для запуска сервиса можно использовать docker-compose (флаг --build для пересборки)

```shell
docker-compose -f docker-compose.yml up
```

## Создание базы данных

По умолчанию postgres поднимается с параметрами:
* пользователь postgres
* пароль example (задаётся через переменную окружения POSTGRES_PASSWORD)
* хост db (потому что в докере)
* порт 5432

Необходимо создать базу данных, затем применить миграции


## Миграции

После изменения моделей необходимо создать миграции командой

```shell
docker-compose -f docker-compose.yml -f docker-compose.manage.yml up --build makemigrations
```

затем применить их командой

```shell
docker-compose -f docker-compose.yml -f docker-compose.manage.yml up --build migrate
```


## Swagger для dev окружения

Для нормальной работы сваггера необходимо собрать локально статику с помощью команды

```shell
python billing/manage.py collectstatic
```

Работает только с включенным DEBUG в настройках.

После этого сваггер будет доступен по эндпоинту /swagger
